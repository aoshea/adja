!function(a,b){"use strict";a.Utils=b(a)}(this,function(a){var b=function(){var a=Array.prototype.slice.call(arguments),b=a.shift(),c=a.shift();return function(){b.apply(c,a.concat(Array.prototype.slice.call(arguments)))}},c=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){return a.setTimeout(b,1e3/60)};return{proxy:b,requestAnimFrame:c}}),function(a){"use strict";var b=a.document;a.render=function(){function a(a,b,c){var d;if("x-shader/x-fragment"===b.type)d=a.createShader(a.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==b.type)return null;d=a.createShader(a.VERTEX_SHADER)}return a.shaderSource(d,c),a.compileShader(d),a.getShaderParameter(d,a.COMPILE_STATUS)?d:(alert("Error compiling shaders "+a.getShaderInfoLog(d)),null)}function c(c,d){var e,f,g;if(e=b.getElementById(d),!e)return null;for(f="",g=e.firstChild;g;)g.nodeType===g.TEXT_NODE&&(f+=g.textContent),g=g.nextSibling;return a(c,e,f)}function d(a,b,d){var e=c(a,b),f=c(a,d);if(m=a.createProgram(),a.attachShader(m,e),a.attachShader(m,f),a.linkProgram(m),!a.getProgramParameter(m,a.LINK_STATUS))throw new Error("Unable to initialize shader program");a.useProgram(m)}function e(a){n=a.width,o=a.height,l=null;try{l=a.getContext("webgl")||a.getContext("experimental-webgl")}catch(b){}return l?(d(l,"2d-fragment-shader","2d-vertex-shader"),k(),void 0):(alert("Unable to initialise WebGL"),void 0)}function f(a,b,c,d){var e=a+c,f=b+d;p.push(a,b,e,b,a,f,a,f,e,b,e,f);var g=b/l.canvas.height;r.push(1,0,0,g,0,1,0,g,0,1,1,g,0,1,1,g,0,1,0,g,1,0,0,g)}function g(a,b,c,d){p||(p=[]),f(a,b,c,d)}function h(a,b,c,d){q.push(a,b,c,d)}function i(){p=[],q=[],r=[],l.clear(l.COLOR_BUFFER_BIT)}function j(){l.viewport(0,0,l.canvas.width,l.canvas.height),l.blendFunc(l.SRC_ALPHA,l.ONE),l.bindBuffer(l.ARRAY_BUFFER,s),l.vertexAttribPointer(u,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,new Float32Array(p),l.STATIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,t),l.vertexAttribPointer(v,4,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,new Float32Array(r),l.STATIC_DRAW),l.drawArrays(l.TRIANGLES,0,parseInt(p.length/2,10)),l.bindBuffer(l.ARRAY_BUFFER,s),l.vertexAttribPointer(u,2,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,new Float32Array(q),l.STATIC_DRAW),l.bindBuffer(l.ARRAY_BUFFER,t),l.vertexAttribPointer(v,4,l.FLOAT,!1,0,0),l.bufferData(l.ARRAY_BUFFER,new Float32Array(r),l.STATIC_DRAW),l.drawArrays(l.LINES,0,parseInt(q.length/2,10))}function k(){v=l.getAttribLocation(m,"a_colour"),l.enableVertexAttribArray(v),u=l.getAttribLocation(m,"a_position"),l.enableVertexAttribArray(u);var a=l.getUniformLocation(m,"u_resolution");l.uniform2f(a,n,o),s=l.createBuffer(),t=l.createBuffer(),l.enable(l.BLEND),l.disable(l.DEPTH_TEST)}var l,m,n,o,p,q,r,s,t,u,v;return{init:e,clear:i,flush:j,drawRect:g,drawLine:h}}()}(this),function(a){"use strict";var b=a.document,c=a.render,d=a.Utils.proxy,e=a.Utils.requestAnimFrame,f={init:function(a,b){this.x=a,this.y=b,this.ax=0,this.ay=0},update:function(){this.ax*=h.FRICTION,this.ay*=h.FRICTION,this.ay+=h.GRAVITY,this.x+=this.ax,this.y+=this.ay},clone:function(){var a=Object.create(this);return a.init(this.x,this.y),a}},g={init:function(a,b,c){return this.pA=b,this.rest=a,c?(this.pB=c,void 0):(this.pB=b.clone(),this.pin=!0,void 0)},getLine:function(){return{x0:this.pA.x,y0:this.pA.y,x1:this.pB.x,y1:this.pB.y}},update:function(){var a,b,c,d,e,f;a=this.pA.x-this.pB.x,b=this.pA.y-this.pB.y,c=Math.sqrt(a*a+b*b),0===c&&(c=.001),d=1*(this.rest-c)*.5*-1,e=this.pB.x+.5*a,f=this.pB.y+.5*b,a/=c,b/=c,this.pin||(this.pB.x=e+.5*a*this.rest*-1,this.pB.y=f+.5*b*this.rest*-1,this.pB.ax=this.pB.ax+a*d,this.pB.ay=this.pB.ay+b*d),this.pA.x=e+.5*a*this.rest,this.pA.y=f+.5*b*this.rest,this.pA.ax=this.pA.ax+a*-d,this.pA.ay=this.pA.ay+b*-d}},h={REST:12,BOUNDARY:{x0:0,x1:480,y0:0,y1:320},MAX_PARTICLES:910,CURTAIN_COLS:70,CURTAIN_ROWS:12,FRICTION:.99,GRAVITY:.9,init:function(){this.canvas=b.getElementById("canvas"),this.originalWidth=this.canvas.width,this.originalHeight=this.canvas.height,c.init(this.canvas),this.reset(),b.onmousemove=d(this.handleMouseMove,this),b.onmousedown=d(this.handleMouseDown,this),b.onmouseup=d(this.handleMouseUp,this),a.addEventListener("resize",d(this.handleResize,this)),e(d(this.tick,this)),this.handleResize()},draw:function(){c.clear(),this.drawParticles(),this.drawConstraints(),c.flush()},drawParticles:function(){var a,b,d=this.numParticles;for(b=0;d>b;++b){a=this.particles[b];var e=10;c.drawRect(a.x-e/2,a.y-e/2,e,e)}},drawConstraints:function(){var a,b,d=this.constraints.length;for(a=0;d>a;++a)b=this.constraints[a].getLine(),c.drawLine(b.x0,b.y0,b.x1,b.y1)},updateMouse:function(){this.mouseDown&&this.applyForceFrom(this.mouseX,this.mouseY,-1)},update:function(){this.updateMouse(),this.updateParticles(),this.updateConstraints()},updateParticles:function(){var a,b=this.numParticles;for(a=0;b>a;++a)this.particles[a].update()},updateConstraints:function(){var a,b=this.constraints.length;for(a=0;b>a;++a)this.constraints[a].update()},tick:function(){this.update(),this.draw(),e(d(this.tick,this))},reset:function(){this.createParticles(),this.createCurtain(h.CURTAIN_COLS,h.CURTAIN_ROWS)},randInRange:function(a){return parseInt(Math.random()*a,10)},createParticles:function(){var a,b,c=h.MAX_PARTICLES;for(this.particles=[],b=0;c>b;++b)a=Object.create(f),a.init(0,0),this.particles.push(a);this.numParticles=this.particles.length},createConstraint:function(a,b,c){var d=Object.create(g);d.init(h.REST,a,b),c.push(d)},pinConstraint:function(a,b){var c=Object.create(g);c.init(1,a),b.push(c)},createCurtain:function(a,b){var c,d,e=0;for(this.constraints=[],c=0;a>c;++c){for(d=0;b>d;++d){if(e>=this.numParticles-1)return;this.createConstraint(this.particles[e++],this.particles[e],this.constraints),this.particles[e-1].x=h.BOUNDARY.x1/2+c*h.REST,this.particles[e-1].y=d*h.REST,0===d&&this.pinConstraint(this.particles[e-1],this.constraints),c>0&&this.createConstraint(this.particles[e],this.particles[e-b-1],this.constraints)}++e}},applyForceFrom:function(a,b,c){var d,e,f,g,h,i=this.numParticles;for(h=0;i>h;++h)g=this.particles[h],d=g.x-a,e=g.y-b,f=Math.sqrt(d*d+e*e),d/=f,e/=f,g.ax+=d*c,g.ay+=e*c},getNearestParticle:function(a,b){var c,d,e,f,g,h=1e3;for(e=0;e<this.numParticles;++e)c=this.particles[e].x-a,d=this.particles[e].y-b,f=Math.sqrt(c*c+d*d),h>f&&(g=this.particles[e],h=f);return g},setMousePosition:function(a,b){var c=this.canvas.width/this.originalWidth,d=this.canvas.height/this.originalHeight;this.mouseX=a/c,this.mouseY=b/d},handleMouseDown:function(a){this.mouseDown=!0,this.setMousePosition(a.pageX,a.pageY)},handleMouseUp:function(){this.mouseDown=!1},handleMouseMove:function(a){this.setMousePosition(a.pageX,a.pageY)},handleResize:function(){this.canvas.width=b.documentElement.clientWidth,this.canvas.height=b.documentElement.clientHeight}},i=Object.create(h);i.init()}(this);